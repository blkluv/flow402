(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[298],{6601:function(){},4050:function(e,t,s){Promise.resolve().then(s.bind(s,4819))},4819:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(7437),l=s(2265);function r(e){let{isPlaying:t,type:s="random",video:r=null}=e,n=(0,l.useRef)(null),i=(0,l.useRef)(null),o=(0,l.useRef)(null),[c,d]=(0,l.useState)(!1);function u(e){try{let t=new URL(e);if("youtu.be"===t.hostname)return t.pathname.slice(1).split("?")[0];if(t.hostname.includes("youtube.com")){if(t.pathname.startsWith("/embed/"))return t.pathname.split("/embed/")[1].split("/")[0];if(t.searchParams.get("v"))return t.searchParams.get("v")}}catch(e){}return null}(0,l.useEffect)(()=>{if("youtube"===s||r&&u(r.videoUrl)){if(!window.YT){let e=document.createElement("script");e.src="https://www.youtube.com/iframe_api",document.body.appendChild(e)}window.onYouTubeIframeAPIReady=()=>{o.current=new window.YT.Player("yt-player",{events:{onReady:()=>{console.log("✅ YouTube player ready")}}})}}},[s,r]),(0,l.useEffect)(()=>{let e="youtube"===s||!!r&&u(r.videoUrl);e&&o.current?t?o.current.playVideo():o.current.pauseVideo():!e&&n.current&&(t?n.current.play().catch(()=>{}):n.current.pause())},[t,s,r]);let m={youtube:{kind:"youtube",id:"1jzROE6EhxM"},movie:{kind:"video",url:"https://github.com/JamieMay2020/flow402/blob/main/1027.mp4?raw=true",poster:"/movie-poster.jpg"},random:{kind:"video",url:"https://www.w3schools.com/html/mov_bbb.mp4"}},h=m[s]||m.random;if(r){let e=u(r.videoUrl),t=function(e){try{let t=new URL(e);if(t.hostname.includes("twitch.tv")){if("player.twitch.tv"===t.hostname)return t.searchParams.get("channel")||null;let e=t.pathname.split("/").filter(Boolean);if(e.length>0)return e[0]}}catch(e){}return null}(r.videoUrl);h=e?{kind:"youtube",id:e}:t?{kind:"twitch",channel:t}:{kind:"video",url:r.videoUrl,poster:r.thumbnailUrl}}return(0,a.jsxs)("div",{className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden",children:[(null==r?void 0:r.ownerPublicKey)&&(0,a.jsx)("button",{type:"button",onClick:()=>d(e=>!e),className:"absolute top-3 right-3 z-20 bg-white/10 hover:bg-white/20 text-white text-xs px-2 py-1 rounded",children:"Info"}),c&&(null==r?void 0:r.ownerPublicKey)&&(0,a.jsxs)("div",{className:"absolute top-10 right-3 z-20 bg-black/80 border border-neutral-700 rounded p-3 text-xs text-gray-200 max-w-[80%]",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:"Creator Wallet"}),(0,a.jsx)("div",{className:"break-all text-gray-300",children:r.ownerPublicKey})]}),!t&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 z-10",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"Approval Required"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Approve token streaming to start watching"})]})}),"youtube"===h.kind?(0,a.jsx)("iframe",{id:"yt-player",ref:i,className:"w-full h-full",src:"https://www.youtube.com/embed/".concat(h.id,"?enablejsapi=1&controls=1&rel=0&modestbranding=1&autoplay=").concat(t?1:0),title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):"twitch"===h.kind?(0,a.jsx)("iframe",{className:"w-full h-full",src:"https://player.twitch.tv/?channel=".concat(h.channel,"&parent=").concat(window.location.hostname,"&autoplay=").concat(t?"true":"false"),title:"Twitch stream player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,a.jsxs)("video",{ref:n,className:"w-full h-full",controls:t,loop:!0,muted:!0,playsInline:!0,poster:h.poster||"",children:[(0,a.jsx)("source",{src:h.url,type:"video/mp4"}),"Your browser does not support the video tag."]})]})}var n=s(8782),i=s(7818),o=s(5429),c=s(5930),d=s(7598);async function u(e){let{userPublicKey:t,sendTransaction:s,gatewayPubkey:a="6agWSyTuiUv1FTYnW9Qb8iHCkn5NSoFkULxKsrZATooT",allowance:l=1,usdcMint:r="DKrZp2YpejxEFzpS9B5cRyr6U28zoNfHWX4pijTcpump"}=e;if(console.log("DEBUG env check →",a,r),!a||!r)throw Error("Missing env: NEXT_PUBLIC_GATEWAY_PUBKEY / NEXT_PUBLIC_USDC_MINT");let n=new o.Connection("https://api.devnet.solana.com"),i=new o.PublicKey(r),u=new o.PublicKey(a),m=new o.PublicKey(t),h=BigInt(Math.floor(1e6*l)),p=await (0,c.Am)(i,m),x=new o.Transaction().add((0,d.ep)(p,i,u,m,Number(h),6)),f=await s(x,n,{skipPreflight:!1});return await n.confirmTransaction(f,"confirmed"),f}var m=s(5566);let h=(0,i.default)(async()=>(await Promise.all([s.e(432),s.e(458)]).then(s.bind(s,8458))).WalletMultiButton,{loadableGenerated:{webpack:()=>[null]},ssr:!1}),p=m.env.NEXT_PUBLIC_BACKEND_URL||"https://flowserver.onrender.com",x=p.endsWith("/")?p.slice(0,-1):p;function f(e){let{onApprovalSuccess:t,onStop:s,uploaderPubkey:r}=e,{publicKey:i,connected:o,sendTransaction:c}=(0,n.O)(),[d,m]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1),[b,v]=(0,l.useState)(!1),y=(0,l.useMemo)(()=>"6agWSyTuiUv1FTYnW9Qb8iHCkn5NSoFkULxKsrZATooT",[]);async function g(){if(o&&i){m(!0);try{let e=await u({userPublicKey:i,sendTransaction:c,gatewayPubkey:y,allowance:1e6,usdcMint:"DKrZp2YpejxEFzpS9B5cRyr6U28zoNfHWX4pijTcpump"});await fetch("".concat(x,"/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userPubkey:i.toString(),uploaderPubkey:r})}),f(!0),console.log("Approve tx:",e),t&&t()}catch(e){console.error(e),alert("Approval failed: "+e.message)}finally{m(!1)}}}async function w(){await fetch("".concat(x,"/stop"),{method:"POST"}),f(!1),s&&s()}return(0,l.useEffect)(()=>v(!0),[]),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold mb-3",children:"Wallet & Session"}),(0,a.jsx)("div",{className:"flex items-center gap-3 mb-4",children:b&&(0,a.jsx)(h,{})}),i&&(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-4 break-all",children:i.toString()}),(0,a.jsxs)("div",{className:"text-sm text-gray-300 mb-4",children:["Rate: ",(0,a.jsx)("b",{children:"1 Flow / second"}),(0,a.jsx)("b",{})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{className:"button-primary disabled:opacity-50",disabled:!o||p||d,onClick:g,children:d?"Approving…":p?"Streaming Active":"Approve & Start"}),(0,a.jsx)("button",{className:"button-secondary disabled:opacity-50",disabled:!p,onClick:w,children:"Stop Streaming"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-3",children:p?"Streaming payments active — 1 token per second.":"Grant permission to start streaming token payments."})]})}function b(e){let{transactions:t=[]}=e,s=Array.isArray(t)?t:[];return(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Transaction Log"}),(0,a.jsx)("div",{className:"space-y-2 text-sm font-mono",children:0===s.length?(0,a.jsx)("p",{className:"text-gray-500",children:"No transactions yet"}):s.map((e,t)=>(0,a.jsx)("div",{className:"text-gray-300",children:e.txId?(0,a.jsxs)(a.Fragment,{children:[e.text.split("→")[0],"→"," ",(0,a.jsx)("a",{href:"https://solscan.io/tx/".concat(e.txId),target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline underline-offset-2",children:e.text.split("→")[1].trim()})]}):e.text||e},t))})]})}let v=s(5566).env.NEXT_PUBLIC_BACKEND_URL||"https://flowserver.onrender.com",y=v.endsWith("/")?v.slice(0,-1):v;function g(){let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)([]),[i,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)([]),[h,p]=(0,l.useState)(!0),[x,v]=(0,l.useState)("all"),g=async()=>{console.log("✅ Approval successful, waiting for first transfer..."),n([]);let e=async()=>{try{let e=await fetch("https://flowserver.onrender.com/status");if((await e.json()).firstTransferConfirmed){console.log("\uD83C\uDFAC First transfer confirmed — starting video"),t(!0);return}}catch(e){console.error("Error checking status:",e)}setTimeout(e,1e3)};e()};return(0,l.useEffect)(()=>{if(!e)return;let t=setInterval(async()=>{try{let e=await fetch("https://flowserver.onrender.com/logs"),t=await e.json();n(t)}catch(e){console.error("Failed to fetch logs:",e)}},2e3);return()=>clearInterval(t)},[e]),(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{let t=await fetch("".concat(y,"/videos")),s=await t.json();if(!e)return;m(Array.isArray(s)?s:[])}catch(e){console.error("Failed to load videos:",e)}finally{e&&p(!1)}})(),()=>{e=!1}},[]),(0,a.jsx)("main",{className:"min-h-screen text-white bg-gradient-to-b from-black via-[#0a0a0a] to-black",children:(0,a.jsxs)("div",{className:"px-6 py-16 mx-auto space-y-10 max-w-7xl",children:[(0,a.jsxs)("header",{children:[(0,a.jsx)("h1",{className:"mb-2 text-3xl font-bold",children:"WEB5DTV. Demo"}),(0,a.jsx)("p",{className:"text-gray-400",children:"Select a stream below to start a pay-per-second session."})]}),i||c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid gap-8 lg:grid-cols-3",children:[(0,a.jsx)("div",{className:"p-6 lg:col-span-2 glass",children:(0,a.jsx)(r,{isPlaying:e,type:i,video:c})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"p-6 glass",children:(0,a.jsx)(f,{onApprovalSuccess:g,onStop:()=>{console.log("\uD83D\uDED1 Streaming stopped, pausing video..."),t(!1),n([])},uploaderPubkey:c?c.ownerPublicKey:void 0})}),(0,a.jsx)("div",{className:"p-6 glass",children:(0,a.jsx)(b,{transactions:s})})]})]}),(0,a.jsx)("button",{onClick:()=>{o(null),d(null),t(!1)},className:"mt-10 text-gray-400 underline hover:text-white underline-offset-2",children:"← Back to stream selection"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Built-in demo items"})}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-8 mb-10 sm:grid-cols-2 md:grid-cols-3",children:[{id:"youtube",title:"YouTube Stream",description:"Play a live or demo YouTube video.",thumbnail:"https://img.youtube.com/vi/1jzROE6EhxM/hqdefault.jpg"},{id:"movie",title:"Wolf of Wall Street",description:"Stream a movie.",thumbnail:"https://github.com/JamieMay2020/flow402/blob/main/wolft.jpg?raw=true"}].map(e=>(0,a.jsxs)("div",{onClick:()=>{o(e.id),d(null)},className:"cursor-pointer glass rounded-xl overflow-hidden hover:scale-[1.02] transition-transform duration-300 group",children:[(0,a.jsx)("div",{className:"relative w-full aspect-[16/9] overflow-hidden",children:(0,a.jsx)("img",{src:e.thumbnail,alt:e.title,className:"object-cover w-full h-full transition-transform duration-500 group-hover:scale-105"})}),(0,a.jsxs)("div",{className:"p-5 text-left",children:[(0,a.jsx)("h3",{className:"mb-1 text-xl font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.description})]})]},e.id))}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Approved videos"}),(0,a.jsx)("button",{className:"text-sm text-gray-400 hover:text-white",onClick:async()=>{p(!0);try{let e=await fetch("".concat(y,"/videos")),t=await e.json();m(Array.isArray(t)?t:[])}catch(e){console.error(e)}finally{p(!1)}},children:"Refresh"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>v("all"),className:"px-4 py-2 rounded text-sm transition ".concat("all"===x?"bg-white text-black font-semibold":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),children:"All"}),(0,a.jsx)("button",{onClick:()=>v("video"),className:"px-4 py-2 rounded text-sm transition ".concat("video"===x?"bg-white text-black font-semibold":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),children:"Videos"}),(0,a.jsx)("button",{onClick:()=>v("live"),className:"px-4 py-2 rounded text-sm transition ".concat("live"===x?"bg-white text-black font-semibold":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),children:"Livestreams"}),(0,a.jsx)("button",{onClick:()=>v("movie"),className:"px-4 py-2 rounded text-sm transition ".concat("movie"===x?"bg-white text-black font-semibold":"bg-neutral-800 text-gray-300 hover:bg-neutral-700"),children:"Movies"})]})]}),h?(0,a.jsx)("div",{className:"p-5 text-gray-400 glass rounded-xl",children:"Loading approved videos…"}):0===u.length?(0,a.jsx)("div",{className:"p-5 text-gray-400 glass rounded-xl",children:"No approved videos yet."}):(0,a.jsx)("div",{className:"grid grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-3",children:u.filter(e=>"all"===x||e.contentType===x).map(e=>(0,a.jsxs)("div",{onClick:()=>{d(e),o(null)},className:"cursor-pointer glass rounded-xl overflow-hidden hover:scale-[1.02] transition-transform duration-300 group",children:[(0,a.jsxs)("div",{className:"relative w-full aspect-[16/9] overflow-hidden",children:[(0,a.jsx)("img",{src:e.thumbnailUrl,alt:e.title,className:"object-cover w-full h-full transition-transform duration-500 group-hover:scale-105"}),"live"===e.contentType&&(0,a.jsx)("div",{className:"absolute px-2 py-1 text-xs font-bold text-white bg-red-600 rounded top-2 left-2",children:"LIVE"})]}),(0,a.jsxs)("div",{className:"p-5 text-left",children:[(0,a.jsx)("h3",{className:"mb-1 text-xl font-semibold",children:e.title}),e.description&&(0,a.jsx)("p",{className:"text-sm text-gray-400 break-all",children:e.description}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[(e.lamportsPerSecond/1e5).toFixed(0)/10," FLOW / second"]})]})]},"video-".concat(e.id)))})]})]})})}}},function(e){e.O(0,[814,33,145,971,23,744],function(){return e(e.s=4050)}),_N_E=e.O()}]);